@page "/"

@using System.Net.Http.Json
@using Application.Dtos
@using Domain.Localization
@using Microsoft.Extensions.Localization
@using BlazorApp.Components
@inject HttpClient httpClient
@inject ISnackbar Snackbar
@inject IDialogService Dialog
@inject IStringLocalizer<Resource> Localizer

<PageTitle>Index</PageTitle>

<MudGrid>
    <MudItem xs="12" sm="6" md="3">
        <SimpleCard Title=@Localizer[Resource.BugDtos] Value=@TotalBugs.ToString()
                    MudIcon=@Icons.Material.Filled.BugReport Color=@Color.Error>
        </SimpleCard>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <SimpleCard Title=@Localizer[Resource.ProjectDtos] Value=@TotalProjects.ToString()
                    MudIcon=@Icons.Material.Filled.Plumbing Color=@Color.Success>
        </SimpleCard>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <SimpleCard Title=@Localizer[Resource.UserDtos] Value=@UnnavailableUsers.ToString()
                    MudIcon=@Icons.Material.Filled.VerifiedUser Color=@Color.Info>
        </SimpleCard>
    </MudItem>

    <MudItem xs="12" sm="6" md="3">
        <SimpleCard Title=@Localizer[Resource.UserDtos] Value=@AvailableUsers.ToString()
                    MudIcon=@Icons.Material.Filled.SupervisedUserCircle Color=@Color.Warning>
        </SimpleCard>
    </MudItem>

    <MudItem xs="12" sm="8">
        <MudPaper Class="pa-4" Style="height:300px;">
            Charts comming soon ish...
        </MudPaper>
    </MudItem>
    <MudItem xs="12" sm="4">
        <MudPaper Class="pa-4" Style="height:300px;">
            Charts comming soon ish...
        </MudPaper>
    </MudItem>

</MudGrid>
@code {
    private int AvailableUsers { get; set; }
    private int UnnavailableUsers { get; set; }
    private int TotalBugs { get; set; }
    private int TotalProjects { get; set; }
    private List<UserDto> Users { get; set; } = new List<UserDto>();
    private List<BugDto> Bugs { get; set; } = new List<BugDto>();
    private List<ProjectDto> Projects { get; set; } = new List<ProjectDto>();

    protected override async Task OnInitializedAsync()
    {
        Users = (await httpClient.GetFromJsonAsync<List<UserDto>>("/user")) ?? new List<UserDto>();
        Bugs = (await httpClient.GetFromJsonAsync<List<BugDto>>("/bug")) ?? new List<BugDto>();
        Projects = (await httpClient.GetFromJsonAsync<List<ProjectDto>>("/project")) ?? new List<ProjectDto>();

        TotalBugs = Bugs.Count;
        TotalProjects = Projects.Count;
        AvailableUsers = Users.Count - TotalBugs;
        UnnavailableUsers = TotalBugs;
    }

}